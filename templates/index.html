<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Main Page</title>

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">


    <!-- Custom CSS for hierarchy -->
    <style>
        ul {
            list-style-type: none;
        }

        .hidden {
            display: none;
        }

        /* Mindmap styling */
        #mindmap {
            font-family: Arial, sans-serif;  /* Font family */
            font-size: 18px;  /* Font size */
            color: #333;  /* Font color */
            line-height: 1.5;  /* Line height */
        }

        #mindmap ul {
            padding-left: 30px;  /* Indentation */
        }

        #mindmap a {
            color: #007bff;  /* Link color */
            text-decoration: none;  /* Remove underline */
        }

        #mindmap a:hover {
            color: #0056b3;  /* Link color on hover */
        }

        /* Option card styling */
        .card {
            font-size: 12px;  /* Font size */
        }

        /* Styles for selectable nodes */
        .node-link.selectable {
            color: blue;
            cursor: pointer;
        }

        /* Styles for active "Select Node" button */
        .select-node.active {
            background-color: blue;
            color: white;
        }

        .styled-button {
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            padding: 2px 10px;
            cursor: pointer;
        }

    </style>

</head>
<body>
    <div class="container-fluid">
        <div class="row mt-3">
            <div class="col-12 text-center">
                <h1>Ability Link</h1>
            </div>
        </div>
        <!-- Progress Indicator -->
        <div class="row mt-3">
            <div class="col-6 text-center">
                <!-- Empty -->
            </div>
            <div class="col-6 text-right">
                <p>Progress: <span id="progress">0</span>%</p>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-6 d-flex align-items-center justify-content-center">
                <!-- Mind Map -->
                <ul id="mindmap">
                    <!-- Nested lists can be used to represent the mind map hierarchy -->
                    <li><a href="#" class="node-link" data-node="1">Node 1</a>
                        <ul>
                            <li><a href="#" class="node-link" data-node="1.1">Node 1.1</a></li>
                            <li><a href="#" class="node-link" data-node="1.2">Node 1.2</a></li>
                        </ul>
                    </li>
                    <li><a href="#" class="node-link" data-node="2">Node 2</a>
                        <ul>
                            <li><a href="#" class="node-link" data-node="2.1">Node 2.1</a></li>
                            <li><a href="#" class="node-link" data-node="2.2">Node 2.2</a></li>
                        </ul>
                    </li>
                    <!-- Add more nodes as needed -->
                </ul>
            </div>
            <div class="col-6">
                <!-- Question Introduction -->
                <div class="mt-3 mb-3">
                    <h4 id="question-text">The description for example</h4>
                </div>

                 <!-- Belief Rating -->
                <div class="belief-rating">
                    <p class="mb-1">Rate how much you believe:</p>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefRating" id="belief1" value="1">
                        <label class="form-check-label" for="belief1">1</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefRating" id="belief2" value="2">
                        <label class="form-check-label" for="belief2">2</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefRating" id="belief3" value="3">
                        <label class="form-check-label" for="belief3">3</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefRating" id="belief4" value="4">
                        <label class="form-check-label" for="belief4">4</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefRating" id="belief5" value="5">
                        <label class="form-check-label" for="belief5">5</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefRating" id="belief6" value="6">
                        <label class="form-check-label" for="belief6">6</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefRating" id="belief7" value="7">
                        <label class="form-check-label" for="belief7">7</label>
                    </div>
                    <!-- ... more ratings 2-7 ... -->
                </div>

                <!-- Change in Belief Rating -->
                <div class="belief-change-rating mt-3">
                    <p class="mb-1">Rate how much your belief changed:</p>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefChangeRating" id="beliefChange1" value="1">
                        <label class="form-check-label" for="beliefChange1">1</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefChangeRating" id="beliefChange2" value="2">
                        <label class="form-check-label" for="beliefChange2">2</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefChangeRating" id="beliefChange3" value="3">
                        <label class="form-check-label" for="beliefChange3">3</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefChangeRating" id="beliefChange4" value="4">
                        <label class="form-check-label" for="beliefChange4">4</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefChangeRating" id="beliefChange5" value="5">
                        <label class="form-check-label" for="beliefChange5">5</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefChangeRating" id="beliefChange6" value="6">
                        <label class="form-check-label" for="beliefChange6">6</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="beliefChangeRating" id="beliefChange7" value="7">
                        <label class="form-check-label" for="beliefChange7">7</label>
                    </div>
                    <!-- ... more ratings 2-7 ... -->
                </div>

                <!-- Options -->
                <!-- ... -->
                <!-- Options -->
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title" id="instance">Option</h5>
                        <!-- Statements -->
                        <div class="statements" id="statements">
                            <!-- Initial statement -->
                            <div class="form-row form-group align-items-center">
                                <!-- Option selection -->
                                <div class="col-md-3">
                                    <select class="form-control option-select">
                                        <option value="option1">同能力比较</option>
                                        <option value="option2">不同能力比较</option>
                                        <option value="option3">能力错配</option>
                                        <option value="option4">能力范畴比较</option>
                                    </select>
                                </div>
                                <!-- Expression -->
                                <div class="col-md-9">
                                    <div class="input-group expression-group">
                                         <!-- The expression will be constructed here dynamically -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Add Statement Button -->
                        <button type="button" class="btn btn-secondary add-statement mt-3" data-statements="statements"><i class="fas fa-plus"></i></button>
                    </div>
                </div>                                              
                <!-- ... -->

                <!-- Next Button -->
                <button type="button" class="btn btn-primary btn-block" id="next-button">Next</button>
            </div>
        </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <script>
        // Handle mind map node clicks
        $('.node-link').click(function(e) {
            e.preventDefault();
            $(this).next('ul').toggleClass('hidden');
        });

        // Variable to hold currently selected input field
        var selectedButton = null;

        // Enable node selection when "Select Node" button is clicked
        $('body').on('click', '.select-node', function() {
            // Enter node selection mode
            selectedButton = $(this);  // Store reference to button
            $('.node-link').addClass('selectable');  // Highlight nodes
            selectedButton.addClass('active');  // Highlight button
        });


        // Update input box when node is clicked in node selection mode
        $('body').on('click', '.selectable', function() {
            // Update input field with node value
            var nodeValue = $(this).text();
            //set the value of the selected button
            selectedButton.text(nodeValue);

            // Exit node selection mode
            selectedInputField = null;
            $('.node-link').removeClass('selectable');
            selectedButton.removeClass('active');  // Remove highlight from button
            selectedButton = null;
        });


        // TODO: Add your next button handler here
        $('#next-button').click(function() {
            // Handle next button click here
            // save the current user selection to server 
            // clear all the input content
            // update the progress bar
            // load new question set to the page
            $.getJSON('/get_next_question', function(data) {
                // Clear the current data
                update_question_set(data);
            });
        });

        function update_question_set(data){
            var example_feasibility = data.feasibility
            if (example_feasibility == "feasible") {
                var feasibility_text = "能够稳定"
            } else {
                var feasibility_text = "不能正确"
            }
            var example_text = `一个AI助手<u>${feasibility_text}</u>响应如下指令<br/>\"${data.example_instance}\"，<br/>请评价你因为这个实例对该AI助手响应如下指令的信任度变化和其中原因"`
            $('#question-text').html(example_text)
            // update the remaining 3 command instances to corrsponding parts
            var instance1_text = data.instance1
            $('#instance').html(instance1_text)
        }

        // Add statement button click
        $('.add-statement').click(function() {
            var statementsId = $(this).data('statements');
            $('#' + statementsId).append('\
            <div class="form-row form-group align-items-center">\
                <!-- Option selection -->\
                <div class="col-md-3">\
                    <select class="form-control option-select">\
                        <option value="option1">同能力比较</option>\
                        <option value="option2">不同能力比较</option>\
                        <option value="option3">能力错配</option>\
                        <option value="option4">能力范畴比较</option>\
                    </select>\
                </div>\
                <!-- Expression -->\
                <div class="col-md-9">\
                    <div class="input-group expression-group">\
                            <!-- The expression will be constructed here dynamically -->\
                    </div>\
                </div>\
            </div>\
            ');
        });

        //upload data when html is loaded
        $(document).ready(function() {
            $.getJSON('/get_next_question', function(data) {
                // Clear the current data
                update_question_set(data);
            });
        });

        // On option change
        $('.option-select').change(function() {
            var option = $(this).val();
            var expressionGroup = $(this).parent().next().find('.expression-group');

            // Clear the previous expression
            expressionGroup.empty();

            if(option === "option1") {
                // Construct the expression for option 1
                expressionGroup.append('样例体现的');
                expressionGroup.append('<span class="select-node styled-button mx-2">xxx</span>');
                expressionGroup.append('能力')
                expressionGroup.append('<div class="dropdown"><button class="styled-button dropdown-toggle" type="button" data-toggle="dropdown">强于</button><div class="dropdown-menu"><a class="dropdown-item" href="#">强于</a><a class="dropdown-item" href="#">弱于</a><a class="dropdown-item" href="#">接近</a></div></div>');
                expressionGroup.append('当前指令要求')
            }
            else if(option === "option2") {
                expressionGroup.append('样例体现的');
                expressionGroup.append('<span class="select-node styled-button mx-2">xxx</span>');
                expressionGroup.append('能力')
                expressionGroup.append('<div class="dropdown"><button class="styled-button dropdown-toggle" type="button" data-toggle="dropdown">强于</button><div class="dropdown-menu"><a class="dropdown-item" href="#">强于</a><a class="dropdown-item" href="#">弱于</a><a class="dropdown-item" href="#">接近</a></div></div>');
                expressionGroup.append('当前指令的')
                expressionGroup.append('<span class="select-node styled-button mx-2">xxx</span>');
                expressionGroup.append('能力要求')
            }
            else if(option === "option3") {
                expressionGroup.append('当前指令要求的');
                expressionGroup.append('<span class="select-node styled-button mx-2">xxx</span>');
                expressionGroup.append('能力在样例中没有体现')
            }
            else if(option === "option4") {
                // Construct the expression for option 4, with two node selection sections
                expressionGroup.append('当前指令要求的');
                expressionGroup.append('<span class="select-node styled-button mx-2">xxx</span>');
                expressionGroup.append('能力范畴在样例中没有体现')
            }
        });

        // On dropdown item click
        $(document).on('click', '.dropdown-item', function() {
            // Your logic here
            //change the drop down text to the selected item
            var selected_item = $(this).text();
            $(this).parent().prev().text(selected_item);
           // alert('Dropdown item clicked!');
        });

        
        $('.styled-button').click(function() {
            // Your logic here
            //alert('Button clicked!');
        });




        
    </script>
</body>
</html>
